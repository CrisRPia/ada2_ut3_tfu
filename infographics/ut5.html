<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resumen de Arquitectura: TFU 5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f3f4f6;
        color: #111827;
      }
      .chart-container {
        position: relative;
        width: 100%;
        margin-left: auto;
        margin-right: auto;
        max-width: 600px;
        height: 300px;
        max-height: 350px;
      }
      @media (min-width: 768px) {
        .chart-container {
          height: 350px;
        }
      }
      .diagram-box {
        border: 2px solid #007ea7;
        background-color: #fff;
        padding: 1rem;
        border-radius: 0.5rem;
        text-align: center;
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        width: 100%;
      }
      .diagram-box-sm {
        padding: 0.5rem;
        font-size: 0.875rem;
        width: auto;
      }
      .diagram-arrow {
        font-size: 2.5rem;
        line-height: 1;
        color: #007ea7;
        font-weight: 600;
      }
    </style>
  </head>
  <body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
      <header class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-[#003459] mb-4">
          De Microservicios a Monolito
        </h1>
        <p class="text-xl text-gray-700 max-w-3xl mx-auto">
          Un resumen visual de la migración de arquitectura de TFU 4 a TFU 5.
        </p>
      </header>

      <main class="space-y-12">
        <section
          id="comparison"
          class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center"
        >
          <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold text-[#003459] mb-4 text-center">
              ARQUITECTURA ANTERIOR (TFU 4)
            </h2>
            <p class="text-gray-600 text-center mb-6">
              Un sistema distribuido de 3 microservicios, escalable
              individualmente (ej. `songs-service=3`).
            </p>
            <div class="flex flex-col items-center space-y-3">
              <div class="diagram-box-sm">Usuario (Browser)</div>
              <div class="diagram-arrow">↓</div>
              <div class="diagram-box">Proxy Nginx (SSL, Rate Limit)</div>
              <div class="diagram-arrow">↓</div>
              <div
                class="w-full p-4 border border-dashed border-gray-400 rounded-lg"
              >
                <p class="text-center text-gray-500 mb-2 font-semibold">
                  Red de Contenedores
                </p>
                <div class="flex flex-wrap justify-center gap-4">
                  <div class="diagram-box-sm">Auth Service</div>
                  <div class="diagram-box-sm">Songs Service (x3)</div>
                  <div class="diagram-box-sm">Playlists Service</div>
                </div>
              </div>
              <div class="diagram-arrow">↓</div>
              <div class="diagram-box">Base de Datos (PostgreSQL)</div>
            </div>
          </div>

          <div
            class="bg-white rounded-lg shadow-md p-6 border-4 border-[#00A8E8]"
          >
            <h2 class="text-2xl font-bold text-[#003459] mb-4 text-center">
              NUEVA ARQUITECTURA (TFU 5)
            </h2>
            <p class="text-gray-600 text-center mb-6">
              Un **Monolito Modular** que consolida la lógica en un solo
              servicio (`music-api`) pero mantiene la organización interna.
            </p>
            <div class="flex flex-col items-center space-y-3">
              <div class="diagram-box-sm">Usuario (Browser)</div>
              <div class="diagram-arrow">↓</div>
              <div class="diagram-box">Proxy Nginx (SSL, Rate Limit)</div>
              <div class="diagram-arrow">↓</div>
              <div
                class="w-full p-4 border border-dashed border-gray-400 rounded-lg"
              >
                <p class="text-center text-gray-500 mb-2 font-semibold">
                  Red de Contenedores
                </p>
                <div class="flex flex-wrap justify-center gap-4">
                  <div class="diagram-box-sm text-lg font-bold">
                    music-api (Monolito)
                  </div>
                </div>
              </div>
              <div class="diagram-arrow">↓</div>
              <div class="diagram-box">Base de Datos (PostgreSQL)</div>
            </div>
          </div>
        </section>

        <section id="structure" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-2xl font-bold text-[#003459] mb-6 text-center">
              Estructura del Monolito Modular
            </h3>
            <p class="text-gray-600 mb-6">
              En lugar de un "Big Ball of Mud", el código se organizó por
              dominios, reflejando la estructura de los microservicios
              anteriores. Esto mantiene una alta cohesión y bajo acoplamiento.
            </p>
            <div
              class="bg-gray-800 text-white p-4 rounded-lg font-mono text-sm"
            >
              <p>src/</p>
              <ul class="ml-4">
                <li>
                  <span class="text-cyan-400">auth/</span> (Lógica de
                  autenticación, JWT, SOAP)
                </li>
                <li>
                  <span class="text-cyan-400">common/</span> (Modelos de BD,
                  Controller Raíz/Health)
                </li>
                <li>
                  <span class="text-cyan-400">playlists/</span> (Lógica de
                  gestión de playlists)
                </li>
                <li>
                  <span class="text-cyan-400">songs/</span> (Lógica de
                  canciones, caché, sync de BD)
                </li>
              </ul>
            </div>
          </div>

          <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-2xl font-bold text-[#003459] mb-6 text-center">
              Infraestructura Simplificada
            </h3>
            <p class="text-gray-600 mb-6">
              La migración redujo drásticamente la complejidad de la
              infraestructura de despliegue, simplificando `docker-compose.yml`
              y `nginx.conf`.
            </p>
            <div class="grid grid-cols-2 gap-6 text-center">
              <div class="bg-gray-50 rounded-lg p-6">
                <div class="text-6xl font-bold text-[#00A8E8]">5 → 3</div>
                <div class="text-xl font-semibold text-gray-700 mt-2">
                  Servicios Docker
                </div>
                <p class="text-gray-500 text-sm">
                  (auth, songs, playlists, proxy, db) se redujeron a (music-api,
                  proxy, db)
                </p>
              </div>
              <div class="bg-gray-50 rounded-lg p-6">
                <div class="text-6xl font-bold text-[#00A8E8]">3 → 1</div>
                <div class="text-xl font-semibold text-gray-700 mt-2">
                  Rutas de Proxy
                </div>
                <p class="text-gray-500 text-sm">
                  (.../auth, .../songs, .../playlists) se consolidaron en una
                  sola regla (.../api/)
                </p>
              </div>
            </div>
          </div>
        </section>

        <section id="soap" class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-3xl font-bold text-[#003459] mb-6 text-center">
            Nuevo Requisito TFU 5: Soportar SOAP
          </h2>
          <p class="text-lg text-gray-600 mb-8 text-center max-w-3xl mx-auto">
            Se añadió un endpoint SOAP para el servicio de autenticación. Esto
            se logró implementando el patrón **Adaptador (Hexagonal)**,
            permitiendo que REST y SOAP utilicen la *misma* lógica de negocio
            central.
          </p>
          <div class="flex flex-col items-center space-y-4">
            <div class="diagram-box-sm">Lógica Central (Core)</div>
            <div class="font-mono text-gray-600">
              JwtTokenGenerator.cs | ApplicationDbContext
            </div>
            <div class="flex justify-center w-full max-w-xl">
              <div class="diagram-arrow text-center">↑</div>
              <div class="diagram-arrow text-center">↑</div>
            </div>
            <div class="grid grid-cols-2 gap-4 w-full max-w-xl">
              <div class="diagram-box">Adaptador 1: REST</div>
              <div class="diagram-box">Adaptador 2: SOAP</div>
            </div>
            <div class="grid grid-cols-2 gap-4 w-full max-w-xl">
              <div class="font-mono text-center text-gray-600">
                AuthController.cs<br />(Recibe JSON, devuelve JSON)
              </div>
              <div class="font-mono text-center text-gray-600">
                SoapAuthService.cs<br />(Recibe XML, devuelve XML)
              </div>
            </div>
          </div>
        </section>

        <!-- SECCIÓN ACTUALIZADA -->
        <section id="quality" class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-3xl font-bold text-[#003459] mb-6 text-center">
            Atributo de Calidad Mejorado: Mantenibilidad
          </h2>
          <p class="text-lg text-gray-600 mb-8 text-center max-w-3xl mx-auto">
            La principal ventaja del monolito es la drástica **simplificación
            del código** y la **eliminación de la duplicación**. Esto hace que
            el proyecto sea mucho más fácil de mantener y extender.
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
              <h4 class="text-xl font-semibold text-red-700 mb-3">
                Antes (Microservicios TFU 4)
              </h4>
              <ul class="list-disc list-inside space-y-2 text-gray-700">
                <li>
                  <span class="font-bold">3 copias</span> de `Models.cs` (una en
                  cada servicio).
                </li>
                <li>
                  <span class="font-bold">3 configuraciones</span> de JWT (una
                  en cada `Program.cs`).
                </li>
                <li>
                  Lógica de Auth (ej. `GetCurrentUser`) duplicada o separada.
                </li>
                <li>Alto riesgo de desincronización de modelos.</li>
              </ul>
            </div>
            <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
              <h4 class="text-xl font-semibold text-green-700 mb-3">
                Después (Monolito TFU 5)
              </h4>
              <ul class="list-disc list-inside space-y-2 text-gray-700">
                <li>
                  <span class="font-bold">1 copia</span> de `Models.cs` (en
                  `src/common/models`).
                </li>
                <li>
                  <span class="font-bold">1 configuración</span> de JWT (en
                  `Program.cs`).
                </li>
                <li>
                  Lógica de Auth consolidada en `src/auth` e inyectada en otros
                  módulos.
                </li>
                <li>Cambiar un modelo es un solo cambio en un solo archivo.</li>
              </ul>
            </div>
          </div>
        </section>
        <!-- FIN DE LA SECCIÓN ACTUALIZADA -->

        <footer class="text-center mt-12">
          <h3 class="text-2xl font-bold text-[#003459] mb-4">
            Endpoints Finales
          </h3>
          <div class="flex flex-col md:flex-row justify-center gap-4">
            <a
              href="https://localhost:8443/api/swagger/index.html"
              target="_blank"
              class="block bg-[#00A8E8] text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-[#007EA7] transition-colors"
            >
              Swagger (REST)
            </a>
            <a
              href="https://localhost:8443/api/auth.asmx?wsdl"
              target="_blank"
              class="block bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-700 transition-colors"
            >
              WSDL (SOAP)
            </a>
          </div>
        </footer>
      </main>
    </div>

    <script>
      const tooltipTitleCallback = {
        plugins: {
          tooltip: {
            callbacks: {
              title: function (tooltipItems) {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                if (Array.isArray(label)) {
                  return label.join(" ");
                } else {
                  return label;
                }
              },
            },
          },
        },
      };

      const colors = {
        lightBlue: "#00A8E8",
        mediumBlue: "#007EA7",
        darkBlue: "#003459",
        gray: "#e5e7eb",
      };

      // El gráfico de latencia ha sido eliminado.
      // new Chart(document.getElementById('latencyChart'), { ... });
    </script>
  </body>
</html>
